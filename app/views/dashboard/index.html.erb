<h1><%= t('dashboard.title') %></h1>

<!-- Feedback quick link (Business Dashboard) -->
<div class="d-flex justify-content-end mb-3">
  <%= link_to t('shared.feedback.link', default: "Send Feedback"),
              new_feedback_path,
              class: "btn btn-outline-primary btn-sm" %>
</div>


<div class="container">
  <div class="row">
    <!-- Total Revenue Card -->
    <div class="col-md-4">
      <div class="card text-white bg-primary mb-3">
        <div class="card-header"><%= t('dashboard.cards.total_revenue') %></div>
        <div class="card-body">
          <h5 class="card-title"><%= number_to_currency(@total_revenue, unit: t('currency.unit'), precision: 0) %></h5>
        </div>
      </div>
    </div>

    <!-- Total Expenses Card -->
    <div class="col-md-4">
      <div class="card text-white bg-warning mb-3">
        <div class="card-header"><%= t('dashboard.cards.total_expenses') %></div>
        <div class="card-body">
          <h5 class="card-title"><%= number_to_currency(@total_expenses, unit: t('currency.unit'), precision: 0) %></h5>
        </div>
      </div>
    </div>

    <!-- Total Income Card -->
    <div class="col-md-4">
      <div class="card text-white bg-info mb-3">
        <div class="card-header"><%= t('dashboard.cards.total_income') %></div>
        <div class="card-body">
          <h5 class="card-title"><%= number_to_currency(@total_income, unit: t('currency.unit'), precision: 0) %></h5>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Net Profit Card -->
    <div class="col-md-4">
      <div class="card text-white bg-success mb-3">
        <div class="card-header"><%= t('dashboard.cards.net_profit') %></div>
        <div class="card-body">
          <h5 class="card-title"><%= number_to_currency(@net_profit, unit: t('currency.unit'), precision: 0) %></h5>
        </div>
      </div>
    </div>

    <!-- Low Stock Products Card -->
    <div class="col-md-4">
      <div class="card text-white bg-danger mb-3">
        <div class="card-header"><%= t('dashboard.cards.low_stock_products') %></div>
        <div class="card-body">
          <% if @low_stock_products.any? %>
            <% @low_stock_products.each do |product| %>
              <p>
                <%= product.name %> —
                <%= t('dashboard.labels.stock_left') %>:
                <%= product.quantity %>
              </p>
            <% end %>
          <% else %>
            <p><%= t('dashboard.messages.all_stock_ok') %></p>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Top-Selling Products Card -->
    <div class="col-md-4">
      <div class="card text-white bg-secondary mb-3">
        <div class="card-header"><%= t('dashboard.cards.top_selling_products') %></div>
        <div class="card-body">
          <% if @top_selling_products.any? %>
            <% @top_selling_products.each do |product| %>
              <p>
                <%= product.name %> —
                <%= t('dashboard.labels.sold') %>:
                <%= product.total_sold %>
              </p>
            <% end %>
          <% else %>
            <p><%= t('dashboard.messages.no_top_selling') %></p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Download PDF -->
  <div class="row">
    <div class="col-md-12 mt-4">
      <%= link_to t('dashboard.download_pdf'), download_pdf_path, class: "btn btn-primary" %>
    </div>
  </div>

  <!-- Products List -->
  <div class="row">
    <div class="col-md-12 mt-4">
      <h2><%= t('dashboard.tables.products.title') %></h2>
      <%= search_form_for @q_products, url: authenticated_root_path, method: :get do |f| %>
        <div class="form-group row">
          <div class="col-md-10">
            <%= f.search_field :name_cont,
              placeholder: t('dashboard.tables.products.search_placeholder'),
              class: "form-control" %>
          </div>
          <div class="col-md-2">
            <%= f.submit t('shared.buttons.search', default: 'Search'), class: "btn btn-primary" %>
          </div>
        </div>
      <% end %>

      <table class="table table-striped">
        <thead>
          <tr>
            <th><%= t('dashboard.tables.products.columns.name') %></th>
            <th><%= t('dashboard.tables.products.columns.category') %></th>
            <th><%= t('dashboard.tables.products.columns.price') %></th>
            <th><%= t('dashboard.tables.products.columns.quantity') %></th>
          </tr>
        </thead>
        <tbody>
          <% @products.each do |product| %>
            <tr>
              <td><%= product.name %></td>
              <td><%= product.category %></td>
              <td><%= t('currency.unit') %> <%= product.price %></td>
              <td><%= product.quantity %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Sales List -->
    <div class="col-md-12 mt-4">
      <h2><%= t('dashboard.tables.sales.title') %></h2>
      <%= search_form_for @q_sales, url: authenticated_root_path, method: :get do |f| %>
        <div class="form-group row">
          <div class="col-md-10">
            <%= f.search_field :product_name_cont,
              placeholder: t('dashboard.tables.sales.search_placeholder'),
              class: "form-control" %>
          </div>
          <div class="col-md-2">
            <%= f.submit t('shared.buttons.search', default: 'Search'), class: "btn btn-primary" %>
          </div>
        </div>
      <% end %>

      <table class="table table-striped">
        <thead>
          <tr>
            <th><%= t('dashboard.tables.sales.columns.product') %></th>
            <th><%= t('dashboard.tables.sales.columns.quantity') %></th>
            <th><%= t('dashboard.tables.sales.columns.total_price') %></th>
            <th><%= t('dashboard.tables.sales.columns.date') %></th>
          </tr>
        </thead>
        <tbody>
          <% @sales.each do |sale| %>
            <tr>
              <td><%= sale.product.name %></td>
              <td><%= sale.quantity %></td>
              <td><%= t('currency.unit') %> <%= sale.total_price %></td>
              <td><%= l(sale.date, format: :ymd) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Income List -->
    <div class="col-md-12 mt-4">
      <h2><%= t('dashboard.tables.incomes.title') %></h2>
      <%= search_form_for @q_incomes, url: authenticated_root_path, method: :get do |f| %>
        <div class="form-group row">
          <div class="col-md-10">
            <%= f.search_field :name_cont,
              placeholder: t('dashboard.tables.incomes.search_placeholder'),
              class: "form-control" %>
          </div>
          <div class="col-md-2">
            <%= f.submit t('shared.buttons.search', default: 'Search'), class: "btn btn-primary" %>
          </div>
        </div>
      <% end %>

      <table class="table table-striped">
        <thead>
          <tr>
            <th><%= t('dashboard.tables.incomes.columns.name') %></th>
            <th><%= t('dashboard.tables.incomes.columns.category') %></th>
            <th><%= t('dashboard.tables.incomes.columns.amount') %></th>
            <th><%= t('dashboard.tables.incomes.columns.date') %></th>
          </tr>
        </thead>
        <tbody>
          <% @incomes.each do |income| %>
            <tr>
              <td><%= income.name %></td>
              <td><%= income.category %></td>
              <td><%= t('currency.unit') %> <%= income.amount %></td>
              <td><%= l(income.date, format: :ymd) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Expenses List -->
    <div class="col-md-12 mt-4">
      <h2><%= t('dashboard.tables.expenses.title') %></h2>
      <%= search_form_for @q_expenses, url: authenticated_root_path, method: :get do |f| %>
        <div class="form-group row">
          <div class="col-md-10">
            <%= f.search_field :name_cont,
              placeholder: t('dashboard.tables.expenses.search_placeholder'),
              class: "form-control" %>
          </div>
          <div class="col-md-2">
            <%= f.submit t('shared.buttons.search', default: 'Search'), class: "btn btn-primary" %>
          </div>
        </div>
      <% end %>

      <table class="table table-striped">
        <thead>
          <tr>
            <th><%= t('dashboard.tables.expenses.columns.name') %></th>
            <th><%= t('dashboard.tables.expenses.columns.category') %></th>
            <th><%= t('dashboard.tables.expenses.columns.amount') %></th>
            <th><%= t('dashboard.tables.expenses.columns.date') %></th>
          </tr>
        </thead>
        <tbody>
          <% @expenses.each do |expense| %>
            <tr>
              <td><%= expense.name %></td>
              <td><%= expense.category %></td>
              <td><%= t('currency.unit') %> <%= expense.amount %></td>
              <td><%= l(expense.date, format: :ymd) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
